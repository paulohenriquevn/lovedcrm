# üö® TEMPLATE RULES - Multi-Tenant SaaS Starter Template Development

**IMPORTANTE:** Seja EXTREMAMENTE HONESTO SEMPRE em rela√ß√£o √† situa√ß√£o do projeto. Nunca inicie algo antes de ter 95% de certeza. N√£o fa√ßa nenhuma altera√ß√£o antes que voc√™ tenha 95% de confian√ßa sobre o que deve ser constru√≠do. Fa√ßa perguntas at√© ter certeza absoluta.

## üéØ **FUNDAMENTAL TEMPLATE CUSTOMIZATION RULES**

### **95% CONFIDENCE RULE FOR TEMPLATE DEVELOPMENT**

- ‚úÖ **MUST**: Validate EACH item with 95%+ confidence before implementing in YOUR SaaS
- ‚úÖ **MUST**: Ask questions until absolutely certain about YOUR business requirements
- ‚úÖ **MUST**: Stop and obtain specific evidence if any template validation fails
- ‚ùå **MUST NOT**: Start any template customization without 95% confidence
- ‚ùå **MUST NOT**: Assume requirements or make speculative interpretations about YOUR SaaS needs
- ‚ùå **MUST NOT**: Continue without complete validation of YOUR business inputs

### **FAIL-FAST VALIDATION PRINCIPLE**

**ALWAYS detect errors and invalid conditions as early as possible and immediately halt execution:**

- ‚úÖ **MUST**: Validate data at the earliest possible point (input, function start, process beginning)
- ‚úÖ **MUST**: Immediately halt execution when validation fails (throw exceptions, return errors)
- ‚úÖ **MUST**: Provide specific error messages indicating problem nature and resolution
- ‚úÖ **MUST**: Prevent invalid data from propagating through system
- ‚úÖ **MUST**: Implement UI validation with immediate user feedback
- ‚úÖ **MUST**: Validate API requests before processing to protect backend
- ‚úÖ **MUST**: Apply domain logic validation to maintain data integrity
- ‚úÖ **MUST**: Use early prototypes and feedback loops in development
- ‚ùå **MUST NOT**: Allow invalid data to continue processing
- ‚ùå **MUST NOT**: Attempt recovery with corrupted/invalid states
- ‚ùå **MUST NOT**: Provide generic or unclear error messages
- ‚ùå **MUST NOT**: Skip validation for performance reasons

### **EXTREME HONESTY ABOUT TEMPLATE STATUS**

- ‚úÖ **MUST**: Be EXTREMELY HONEST about YOUR template customization progress
- ‚úÖ **MUST**: Report template problems and limitations immediately
- ‚úÖ **MUST**: Communicate clearly when there's insufficient certainty about YOUR requirements
- ‚ùå **MUST NOT**: Mask template issues or give false guarantees about YOUR SaaS
- ‚ùå **MUST NOT**: Proceed without communicating identified risks in YOUR customization
- ‚ùå **MUST NOT**: Give vague or evasive responses about YOUR development status

### **üîç CODEBASE ANALYSIS OBRIGAT√ìRIA - REGRA CR√çTICA**

**ANTES DE CRIAR QUALQUER COMPONENTE, SERVI√áO, API OU MODEL:**

- ‚úÖ **OBRIGAT√ìRIO**: Analisar o codebase existente PRIMEIRO usando Glob/Grep/Read tools
- ‚úÖ **OBRIGAT√ìRIO**: Verificar se o componente/servi√ßo J√Å EXISTE no template
- ‚úÖ **OBRIGAT√ìRIO**: Se existe: EVOLUIR o existente, NUNCA criar duplicado
- ‚úÖ **OBRIGAT√ìRIO**: Se n√£o existe: Verificar padr√µes similares para seguir
- ‚úÖ **OBRIGAT√ìRIO**: Documentar an√°lise realizada: "Analisado X arquivos, encontrado Y similar"
- ‚úÖ **OBRIGAT√ìRIO**: Justificar decis√£o: "Evoluindo Z existente" OU "Criando novo porque..."
- ‚ùå **PROIBIDO**: Criar componentes/servi√ßos sem an√°lise pr√©via do codebase
- ‚ùå **PROIBIDO**: Duplicar funcionalidades existentes sem justificativa extrema
- ‚ùå **PROIBIDO**: Assumir que algo n√£o existe sem verifica√ß√£o completa

**PROCESSO DE VALIDA√á√ÉO OBRIGAT√ìRIO:**

1. **BUSCAR PRIMEIRO**: `Glob "**/*.tsx"` + `Grep "ComponentName"` + `Read similares`
2. **ANALISAR EXISTENTES**: Verificar funcionalidades, props, padr√µes
3. **DECIDIR**: Evoluir existente OU criar novo (com justificativa)
4. **DOCUMENTAR**: "An√°lise: X componentes encontrados, evolu√ß√£o Y aplicada"
5. **IMPLEMENTAR**: Seguir padr√µes identificados na an√°lise

## üèóÔ∏è **TEMPLATE ARCHITECTURE & TECHNOLOGY RULES**

### **TEMPLATE FOUNDATION REQUIREMENTS**

- ‚úÖ **DEVE**: Usar EXCLUSIVAMENTE Next.js 14 + FastAPI + PostgreSQL + Railway
- ‚úÖ **DEVE**: Aproveitar sistema em produ√ß√£o com 55+ endpoints ativos
- ‚úÖ **DEVE**: Implementar isolation com header-based multi-tenancy (X-Org-Id + middleware)
- ‚úÖ **DEVE**: Usar organization_middleware.py + Repository pattern + org_id filtering
- ‚úÖ **DEVE**: Usar shadcn/ui + Tailwind CSS + Lucide icons
- ‚ùå **N√ÉO DEVE**: Sugerir outras tecnologias ou frameworks
- ‚ùå **N√ÉO DEVE**: Criar arquiteturas que n√£o aproveitem sistema atual
- ‚ùå **N√ÉO DEVE**: Ignorar padr√µes de isolation estabelecidos

### **TEMPLATE SAAS_MODE - B2B ONLY**

- üî¥ **FATO CR√çTICO**: Sistema √© exclusivamente B2B mode
- üî¥ **FATO CR√çTICO**: Modo B2B: Colabora√ß√£o em equipe com organiza√ß√µes compartilhadas
- ‚úÖ **DEVE**: Configurar SAAS_MODE=B2B via vari√°vel de ambiente
- ‚úÖ **DEVE**: Usar organiza√ß√£o auto-criada no registro (B2B mode)
- ‚úÖ **DEVE**: UI sempre com team features habilitadas
- ‚úÖ **DEVE**: Manter isolation organization-centric sempre (org_id universal)
- ‚úÖ **DEVE**: Implementar billing apropriado para o modo escolhido
- ‚ùå **N√ÉO DEVE**: Misturar funcionalidades B2B e B2C no mesmo deployment
- ‚ùå **N√ÉO DEVE**: Quebrar organiza√ß√£o auto-criada (essencial para ambos modos)
- ‚ùå **N√ÉO DEVE**: Sugerir user_id isolation (template usa org_id sempre)
- ‚ùå **N√ÉO DEVE**: Ignorar configura√ß√£o SAAS_MODE estabelecida

### **PADR√ïES T√âCNICOS MULTI-TENANT OBRIGAT√ìRIOS**

- ‚úÖ **DEVE**: Seguir padr√µes do template para qualquer customiza√ß√£o:
  - Registration Pattern: Auto-cria√ß√£o de organiza√ß√£o + JWT com org_id
  - Entity Management Pattern: Org-scoped CRUD com middleware validation
  - Multi-Tenant Pattern: Header-based isolation (X-Org-Id) obrigat√≥rio
- ‚úÖ **DEVE**: Implementar organization_middleware.py validation em todas as rotas
- ‚úÖ **DEVE**: Usar BaseService no frontend (auto X-Org-Id headers)
- ‚úÖ **DEVE**: Aplicar org_id filtering em todas as queries (Repository pattern)
- ‚úÖ **DEVE**: Manter get_current_organization dependency no backend
- ‚ùå **N√ÉO DEVE**: Criar rotas sem organization validation
- ‚ùå **N√ÉO DEVE**: Quebrar header-based multi-tenancy
- ‚ùå **N√ÉO DEVE**: Implementar user_id isolation (sempre org_id)

## üìù **REGRAS DE DOCUMENTA√á√ÉO**

### **TERMINOLOGIA PADRONIZADA**

- ‚úÖ **DEVE**: Usar "funcionalidades" para features do usu√°rio
- ‚úÖ **DEVE**: Usar "padr√µes t√©cnicos" para blueprints reutiliz√°veis
- ‚úÖ **DEVE**: Usar "feature-specific" ao inv√©s de "workflow-specific"
- ‚úÖ **DEVE**: Manter consist√™ncia terminol√≥gica entre agentes
- ‚ùå **N√ÉO DEVE**: Usar "workflow" para funcionalidades do usu√°rio
- ‚ùå **N√ÉO DEVE**: Misturar terminologia t√©cnica e funcional
- ‚ùå **N√ÉO DEVE**: Criar terminologia nova sem valida√ß√£o

### **EXEMPLOS SETORIAIS H√çBRIDOS B2B+B2C**

- ‚úÖ **DEVE**: Usar exemplos B2B: E-commerce B2B, CRM, SaaS B2B, ERP, Marketing
- ‚úÖ **DEVE**: Usar exemplos B2C: Social, Gaming, E-commerce, Fitness, Streaming
- ‚úÖ **DEVE**: Incluir org_id isolation, header validation e Repository pattern
- ‚úÖ **DEVE**: Demonstrar feature gating (Free/Pro/Enterprise ou Free/Premium)
- ‚úÖ **DEVE**: Mostrar isolation organization-centric (org_id sempre)
- ‚ùå **N√ÉO DEVE**: Usar exemplos gen√©ricos sem contexto espec√≠fico
- ‚ùå **N√ÉO DEVE**: Criar exemplos sem isolation adequado
- ‚ùå **N√ÉO DEVE**: Ignorar subscription tiers nos exemplos

## üîÑ **REGRAS DE PROCESSO**

### **METODOLOGIA VERTICAL SLICE**

- ‚úÖ **DEVE**: Organizar por funcionalidades completas end-to-end
- ‚úÖ **DEVE**: Priorizar entrega de valor ao usu√°rio
- ‚úÖ **DEVE**: Implementar features incrementalmente
- ‚úÖ **DEVE**: Validar cada funcionalidade antes da pr√≥xima
- ‚ùå **N√ÉO DEVE**: Organizar por dom√≠nios t√©cnicos (horizontal)
- ‚ùå **N√ÉO DEVE**: Criar big bang implementations
- ‚ùå **N√ÉO DEVE**: Priorizar eleg√¢ncia t√©cnica sobre valor do usu√°rio

### **VALIDA√á√ïES OBRIGAT√ìRIAS**

- ‚úÖ **DEVE**: Executar todas as 5 valida√ß√µes espec√≠ficas de cada agente
- ‚úÖ **DEVE**: Parar imediatamente se qualquer valida√ß√£o falhar
- ‚úÖ **DEVE**: Obter evid√™ncias concretas antes de prosseguir
- ‚úÖ **DEVE**: Documentar crit√©rios de aceite espec√≠ficos
- ‚ùå **N√ÉO DEVE**: Pular valida√ß√µes por press√£o de tempo
- ‚ùå **N√ÉO DEVE**: Aceitar valida√ß√µes superficiais ou gen√©ricas
- ‚ùå **N√ÉO DEVE**: Continuar sem evid√™ncias suficientes

### **CHANGELOG OBRIGAT√ìRIO POR STORY**

- ‚úÖ **DEVE**: Gerar entrada no CHANGELOG.md para CADA story finalizada
- ‚úÖ **DEVE**: Criar changelog na raiz do projeto (formato Keep a Changelog)
- ‚úÖ **DEVE**: Incluir categorias: Adicionado, Alterado, Corrigido, Seguran√ßa
- ‚úÖ **DEVE**: Referenciar story espec√≠fica ([STORY X.Y]) em cada entrada
- ‚úÖ **DEVE**: Usar versionamento sem√¢ntico (MAJOR.MINOR.PATCH)
- ‚úÖ **DEVE**: Documentar funcionalidades em linguagem clara para usu√°rios
- ‚úÖ **DEVE**: Incluir detalhes t√©cnicos para desenvolvedores
- ‚úÖ **DEVE**: Gerar changelog IMEDIATAMENTE ap√≥s deploy bem-sucedido
- ‚ùå **N√ÉO DEVE**: Finalizar story sem entrada no changelog
- ‚ùå **N√ÉO DEVE**: Usar linguagem t√©cnica excessiva para usu√°rios finais
- ‚ùå **N√ÉO DEVE**: Omitir implica√ß√µes de seguran√ßa quando aplic√°veis

### **ATUALIZA√á√ÉO STATUS ROADMAP OBRIGAT√ìRIA**

- ‚úÖ **DEVE**: Atualizar status no roadmap (`docs/project/11-roadmap.md`) para CADA story completada
- ‚úÖ **DEVE**: Marcar story como "‚úÖ CONCLU√çDO (DD/MM/AAAA)" no roadmap
- ‚úÖ **DEVE**: Atualizar progresso do Epic pai quando aplic√°vel
- ‚úÖ **DEVE**: Incluir data de conclus√£o e status de deploy
- ‚úÖ **DEVE**: Atualizar IMEDIATAMENTE ap√≥s valida√ß√£o final da story
- ‚ùå **N√ÉO DEVE**: Considerar story completa sem atualiza√ß√£o do roadmap
- ‚ùå **N√ÉO DEVE**: Deixar stories implementadas com status desatualizado
- ‚ùå **N√ÉO DEVE**: Atualizar roadmap sem valida√ß√£o completa da funcionalidade

## üö´ **PROIBI√á√ïES CR√çTICAS**

### **NUNCA FAZER**

- ‚ùå **NUNCA** criar funcionalidades fora dos padr√µes estabelecidos
- ‚ùå **NUNCA** sugerir tecnologias diferentes do sistema em produ√ß√£o
- ‚ùå **NUNCA** ignorar isolation (org_id + header-based + middleware)
- ‚ùå **NUNCA** criar arquiteturas sem header-based multi-tenancy
- ‚ùå **NUNCA** usar terminologia inconsistente entre agentes
- ‚ùå **NUNCA** prosseguir sem 95% de certeza
- ‚ùå **NUNCA** mascarar problemas ou limita√ß√µes
- ‚ùå **NUNCA** criar scripts ou arquivos fora do padr√£o estabelecido

### **EVOLU√á√ÉO VS CRIA√á√ÉO**

- ‚úÖ **SEMPRE** evoluir arquivos existentes
- ‚úÖ **SEMPRE** seguir padr√µes j√° estabelecidos
- ‚úÖ **SEMPRE** manter coes√£o com agentes anteriores
- ‚ùå **NUNCA** criar novos padr√µes sem aprova√ß√£o
- ‚ùå **NUNCA** reinventar solu√ß√µes j√° definidas
- ‚ùå **NUNCA** quebrar compatibilidade com sistema em produ√ß√£o

## üéØ **CRIT√âRIOS DE QUALIDADE**

### **CHECKLIST OBRIGAT√ìRIO ANTES DE ENTREGAR**

- [ ] **95% de certeza** sobre todos os requisitos
- [ ] **Valida√ß√µes espec√≠ficas** todas executadas e aprovadas
- [ ] **Terminologia consistente** com outros agentes
- [ ] **Isolation** implementado corretamente (header-based org_id)
- [ ] **Sistema Produ√ß√£o** compliance verificado
- [ ] **Padr√µes t√©cnicos** adaptados apropriadamente
- [ ] **Exemplos setoriais** espec√≠ficos inclu√≠dos
- [ ] **Funcionalidades end-to-end** documentadas
- [ ] **Coes√£o com agentes** anteriores mantida
- [ ] **Documenta√ß√£o execut√°vel** validada

### **RED FLAGS - PARAR IMEDIATAMENTE**

- üö® Sugest√£o de tecnologia fora do sistema em produ√ß√£o
- üö® Arquitetura sem header-based multi-tenancy proposta
- üö® Funcionalidades fora dos 3 padr√µes estabelecidos
- üö® Terminologia inconsistente detectada
- üö® Valida√ß√µes falhando ou sendo puladas
- üö® Requisitos assumidos sem confirma√ß√£o
- üö® Quebra de coes√£o com agentes anteriores
- üö® Documenta√ß√£o n√£o execut√°vel
- üö® Exemplos gen√©ricos sem contexto B2B ou B2C espec√≠fico

## üìä **RESPONSABILIDADES**

## üîÑ **FLUXO DE VALIDA√á√ÉO**

### **ENTRADA DE CADA**

### **SA√çDA DE CADA AGENTE**

## üéØ **OBJETIVO FINAL**

**Manter Multi-Tenant SaaS Starter Template com:**

- **99% coes√£o** t√©cnica entre documenta√ß√µes
- **100% aproveitamento** sistema em produ√ß√£o (55+ endpoints)
- **100% header-based multi-tenancy** implementation
- **100% executabilidade** documenta√ß√£o t√©cnica
- **100% adaptabilidade** para SaaS B2B ou B2C (via SAAS_MODE)

---

## üö® **LEMBRETE CR√çTICO**

**Estas regras s√£o OBRIGAT√ìRIAS e N√ÉO NEGOCI√ÅVEIS. Qualquer viola√ß√£o compromete a integridade do Multi-Tenant SaaS Starter Template.**

**SEMPRE seguir: 95% certeza ‚Üí Valida√ß√µes completas ‚Üí Header-based Multi-tenancy ‚Üí Sistema Produ√ß√£o ‚Üí Coes√£o 99%**
